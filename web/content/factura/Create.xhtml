<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

    <ui:composition template="/index.xhtml">
        <ui:define name="title">
            <h:outputText value="#{bundle.MessageCreateOrdenPedido}"/>
        </ui:define>
        <ui:define name="body">
            <h:form id="FacturaCreateForm">
                <h:panelGroup id="display" >
                    <p:panel header="Datos Factura">
                        <p:panelGrid columns="6">
                            <p:outputLabel value="#{bundle.CreateVisitaLabel_fecha}" for="fecha"/>
                            <p:calendar mindate="#{visitaController.fechaActual}" id="fecha" pattern="MM/dd/yyyy HH:mm:ss"
                                        value="#{facturaController.selected.fecha}" title="#{bundle.EditVisitaTitle_fecha}"
                                        required="true" requiredMessage="#{bundle.EditVisitaRequiredMessage_fecha}" showOn="button"/>
                            <p:outputLabel value="#{bundle.MessageCodigoPedido}" for="codigo"/>
                            <p:inputText id="codigo" value="#{facturaController.selected.ordenPedido}"/>
                            <p:outputLabel value="#{bundle.MessageCreateTipoPago}" for="tipo_pago" />
                            <p:selectOneMenu id="tipo_pago" value="#{facturaController.selected.tipo_pago}" 
                                             required="true" requiredMessage="#{bundle.CreateVisitaRequiredMessage_estado}">
                                <f:selectItem  itemLabel="#{bundle.SelectOneMessage}"/>
                                <f:selectItems value="#{facturaController.tiposEstado}" />
                            </p:selectOneMenu>
                            <p:outputLabel value="#{bundle.CreateVisitaLabel_cliente}" for="cliente"/>
                            <p:selectOneMenu id="cliente" value="#{facturaController.selected.cliente}" required="true"
                                             requiredMessage="#{bundle.EditVisitaRequiredMessage_empleado}">
                                <p:ajax update="listaProductos" listener="#{facturaController.getDescuentobyCliente(facturaController.selected.cliente)}"/>
                                <f:selectItem  itemLabel="#{bundle.SelectOneMessage}"/>
                                <f:selectItems value="#{clienteController.itemsAvailableSelectOne}"
                                               var="clienteItem"
                                               itemValue="#{clienteItem}"/>
                            </p:selectOneMenu>
                            <p:outputLabel value="#{bundle.CreateVisitaLabel_empleado}" for="empleado" />
                            <p:selectOneMenu id="empleado" value="#{facturaController.selected.empleado}" required="true" requiredMessage="#{bundle.EditVisitaRequiredMessage_empleado}">
                                <f:selectItem  itemLabel="#{bundle.SelectOneMessage}"/>
                                <f:selectItems value="#{empleadoController.itemsAvailableSelectOne}"
                                               var="empleadoItem"
                                               itemValue="#{empleadoItem}"/>
                            </p:selectOneMenu><h:outputText/><h:outputText/>
                            <p:outputLabel value="#{bundle.CreateDevolucionLabel_observaciones}" for="observaciones"/>
                            <p:inputTextarea id="observaciones" value="#{facturaController.selected.observaciones}"/>
                        </p:panelGrid>
                    </p:panel>

                    <br/>
                    <p:panel header="Agregar Productos">
                        <p:panelGrid columns="9">
                            <p:outputLabel value="#{bundle.CreateProductoLabel_producto}"/>
                            <p:autoComplete id="producto" minQueryLength="3" value="#{facturaController.facturaProducto.producto}" itemValue="#{pro}" 
                                            completeMethod="#{promocionController.llenarProducto}" effect="fade" converter="productoconverter" itemLabel="#{pro.toString()}" var="pro" />

                            <p:outputLabel value="#{bundle.MessageCreateVenta}" for="venta"/>
                            <p:inputText value="#{facturaController.facturaProducto.unidadesVenta}" id="venta"/>

                            <p:outputLabel value="#{bundle.MessageCreateBonificacion}" for="bonificacion"/>
                            <p:inputText value="#{facturaController.facturaProducto.unidadesBonificacion}" id="bonificacion"/>

                            <p:outputLabel value="#{bundle.MessageCreatePrecio}" for="precio"/>
                            <p:inputText value="#{facturaController.facturaProducto.precio}" id="precio"/>
                            <p:commandButton value="#{bundle.AddItem}" icon="ui-icon-plus"
                                             actionListener="#{facturaController.addFacturaProducto()}" update="listaProductos"/>
                        </p:panelGrid>
                        <br/>
                        <p:dataTable styleClass="tabla" emptyMessage="#{bundle.EmptyTable}" id="listaProductos" var="itemTMP"
                                     paginator="true" selectionMode="single" value="#{facturaController.itemsTMP}"
                                     rowKey="#{itemTMP.id}"
                                     rows="5"
                                     rowsPerPageTemplate="10,20,30,40,50"
                                     paginatorPosition="bottom"> 
                            <f:facet name="header">
                                <h:outputText value="#{bundle.ListProductoTitle}"/>
                            </f:facet>
                            <p:column width="120">
                                <f:facet name="header">
                                    Código
                                </f:facet>
                                <h:outputText value="#{itemTMP.producto.codigo}"/>
                            </p:column>
                            <p:column>
                                <f:facet name="header">
                                    Descripción
                                </f:facet>
                                <h:outputText value="#{itemTMP.producto.descripcion}"/>
                            </p:column>
                            <p:column style="text-align: center;" width="80">
                                <f:facet name="header">
                                    Venta
                                </f:facet>
                                <h:outputText value="#{itemTMP.unidadesVenta}"/>
                            </p:column>
                            <p:column style="text-align: center;" width="80">
                                <f:facet name="header">
                                    Bonificación
                                </f:facet>
                                <h:outputText value="#{itemTMP.unidadesBonificacion}"/>
                            </p:column>
                            <p:column style="text-align: center;" width="150">
                                <f:facet name="header">
                                    Precio
                                </f:facet>
                                <h:outputText value="#{itemTMP.precio}"/>
                            </p:column>
                            <p:column style="text-align: center;" width="80">
                                <f:facet name="header">
                                    <h:outputText value="Quitar"/>
                                </f:facet>
                                <p:commandButton icon="ui-icon-closethick" update="listaProductos"
                                                 actionListener="#{facturaController.removeFacturaProducto(itemTMP)}"/>
                            </p:column>
                            <p:columnGroup type="footer">
                                <p:row>
                                    <p:column footerText="Totales: " style="text-align:right; font-weight: bold;" colspan="2" rowspan="2"/>
                                    <p:column footerText="#{facturaController.totalUnidadVentas}" />
                                    <p:column footerText="#{facturaController.totalUnidadBonificaciones}" />
                                    <p:column style="font-weight: bold;" footerText="#{bundle.ViewFacturaLabel_totalBruto}"/>
                                    <p:column>
                                        <f:facet name="footer">
                                            <h:outputText value ="#{facturaController.totalPrecioBruto}">
                                                <f:convertNumber type="currency"  currencySymbol="$"/>
                                            </h:outputText>
                                        </f:facet>  
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="font-weight: bold;" footerText="#{bundle.EditFacturaLabel_descuento}"/>
                                    <p:column footerText="% #{facturaController.selected.descuento}"/>
                                    <p:column style="font-weight: bold;" footerText="#{bundle.CreateFacturaTitle_totalPagarForm}"/>
                                    <p:column>
                                        <f:facet name="footer">
                                            <h:outputText value ="#{facturaController.totalAPagar}">
                                                <f:convertNumber type="currency"  currencySymbol="$"/>
                                            </h:outputText>
                                        </f:facet>  
                                    </p:column>
                                </p:row>
                            </p:columnGroup>
                        </p:dataTable>
                    </p:panel>
                    <p:commandButton actionListener="#{facturaController.create}" value="#{bundle.Save}"
                                     icon="ui-icon-disk"/>
                </h:panelGroup>
            </h:form>            
        </ui:define>

    </ui:composition>
</html>
